trigger: none # will disable CI builds entirely

pr:
  - master

pool:
  vmImage: 'windows-2019'
  
steps:

- checkout: self
  clean: true
  lfs: false
  persistCredentials: false

- task: CmdLine@2
  displayName: yarn install
  inputs:
    script: yarn install

- task: CmdLine@2
  displayName: yarn run prepublishOnly
  inputs:
    script: yarn run prepublishOnly

- task: DownloadGitHubRelease@0
  inputs:
    connection: 'react-native-windows'
    userRepository: 'react-native-windows/CalculatorPackage'
    defaultVersionType: 'latest'
    downloadPath: '$(System.ArtifactsDirectory)'

- task: ExtractFiles@1
  inputs:
    archiveFilePatterns: '$(System.ArtifactsDirectory)/*.zip'
    destinationFolder: 'TestApp'
    cleanDestinationFolder: true

- task: PowerShell@1
  displayName: 'Install Calculator Cert'
  inputs:
    scriptType: inlineScript
    arguments: '-NonInteractive -Verb RunAs'
    inlineScript: |
      $file = ( Get-ChildItem -Path TestApp\Calculator_$(PackageManifest)_Test\Calculator_$(PackageManifest)_x64.cer )
      $file | Import-Certificate -CertStoreLocation cert:\LocalMachine\Root

- task: PowerShell@1
  displayName: 'Install Calculator Packages'
  inputs:
    scriptName: 'TestApp\Calculator_$(PackageManifest)_Test\Add-AppDevPackage.ps1'
    arguments: '-NonInteractive -Force:$true  -Verb RunAs'
